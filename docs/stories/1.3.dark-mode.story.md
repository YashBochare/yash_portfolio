# Story 1.3: Implement Dark/Light Mode Context & Toggle

## Status
Approved

## Story
**As a** Developer,
**I want** A functional dark mode toggle with persistent user preference,
**so that** Users can switch between light and dark themes and have their choice remembered

## Acceptance Criteria
1. ThemeContext with localStorage persistence
2. ThemeToggle component with sun/moon icons
3. No flash of wrong theme on load
4. System preference detection

## Tasks / Subtasks
- [ ] Task 1: Create ThemeContext (AC: 1, 4)
  - [ ] Create `src/context/ThemeContext.jsx` with `ThemeContext` and `ThemeProvider`
  - [ ] Implement state initialization logic:
    - Check `localStorage` for saved theme
    - If none, check `window.matchMedia('(prefers-color-scheme: dark)')`
    - Default to system preference or 'light'
  - [ ] Implement `toggleTheme` function
  - [ ] Effect hook to add/remove `dark` class from `document.documentElement`
  - [ ] Effect hook to save preference to `localStorage`
- [ ] Task 2: Create ThemeToggle Component (AC: 2)
  - [ ] Create `src/components/common/ThemeToggle.jsx`
  - [ ] Consume `ThemeContext`
  - [ ] Render a button that toggles theme on click
  - [ ] Display Sun icon for Light mode, Moon icon for Dark mode (use icons from chosen lib)
  - [ ] Add accessible aria-label
- [ ] Task 3: Integrate Provider (AC: 3)
  - [ ] Wrap application root (in `main.jsx` or `App.jsx`) with `ThemeProvider`
  - [ ] Ensure the script runs early enough or uses layout effect to prevent flash (though React hydration might cause slight flicker, initial class setting in `index.html` head script is the robust "no flash" solution, but Context-based is often acceptable for SPA MVP). *Dev Note: For true "no-flash", add a small inline script in `index.html`.*
- [ ] Task 4: Integrate Toggle in UI
  - [ ] Add `ThemeToggle` to `Navbar.jsx`
  - [ ] Verify functionality and persistence on reload

## Dev Notes
- **Context API/Pattern**: Standard React Context Provider pattern. [Source: docs/front-end-architecture.md#implementation-patterns]
- **Tailwind Config**: Ensure `darkMode: 'class'` is set (done in Story 1.1).
- **Icons**: Sun/Moon icons needed. Can use `lucide-react` or similar.
- **Persistence**: Key name should be consistent, e.g., `'portfolio-theme'`.
- **Flash of Unstyled Content (FOUC)**: To strictly meet "No flash" AC, consider adding a blocking script in `index.html` <head> that checks localStorage/system pref and adds the class before React mounts.
  ```html
  <script>
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark')
    } else {
      document.documentElement.classList.remove('dark')
    }
  </script>
  ```

### Testing
- **Test File Location**: `src/context/__tests__/ThemeContext.test.jsx`
- **Standards**: Test that toggling changes the class on document element. Test that localStorage is updated.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2026-01-07 | 1.0 | Initial Draft | Scrum Master |

## Dev Agent Record
_To be populated by Dev Agent_

### Agent Model Used
_..._

### Debug Log References
_..._

### Completion Notes List
_..._

### File List
_..._

## QA Results
_To be populated by QA Agent_
